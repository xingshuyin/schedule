(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f90d6396"],{"5a20":function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"d2p-tree-selector"},[i("div",{staticClass:"el-cascader el-cascader--default",class:{"is-disabled":e.disabled},on:{click:e.openDialog}},[i("div",{staticClass:"el-input el-input--default el-input--suffix",class:{"is-disabled":e.disabled}},[i("el-input",{ref:"reference",attrs:{disabled:e.disabled,placeholder:0===e.selected.length?e.placeholder:""}}),i("span",{staticClass:"el-input__suffix"},[i("span",{staticClass:"el-input__suffix-inner"},[i("i",{staticClass:"el-input__icon el-icon-arrow-down",on:{click:e.openDialog}})])])],1),i("div",{ref:"tags",staticClass:"el-cascader__tags"},[i("transition-group",{on:{"after-leave":e.resetInputHeight}},e._l(e.selected,(function(t){return i("el-tag",{key:e.getValueKey(t),attrs:{closable:e.clearable,size:e.collapseTagSize,hit:!1,type:"info","disable-transitions":""},on:{close:function(i){return e.itemClosed(t)}}},[i("span",{staticClass:"el-select__tags-text"},[e._v(e._s(e.getValueLabel(t)))])])})),1)],1)]),i("el-dialog",{attrs:{"custom-class":"d2p-tree-selector-dialog",title:e.dialogTitle,visible:e.dialogVisible,width:"50%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"tree-wrapper"},[e.treeFilter?i("div",{staticClass:"filter-bar",staticStyle:{"padding-bottom":"20px"}},[i("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:e.filterPlaceholder,size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1):e._e(),i("div",{staticClass:"tree-body"},[i("vxe-grid",e._b({ref:"elTree",attrs:{data:e._options,"auto-resize":!0},on:{"radio-change":e.radioChange,"checkbox-change":e.checkboxChange},scopedSlots:e._u([{key:"pager",fn:function(){return[e.pagination?i("vxe-pager",{staticStyle:{"margin-top":"10px"},attrs:{layouts:["Sizes","PrevJump","PrevPage","Number","NextPage","NextJump","FullJump","Total"],"current-page":e._elProps.page,"page-size":e._elProps.limit,total:e._elProps.total},on:{"update:currentPage":function(t){return e.$set(e._elProps,"page",t)},"update:current-page":function(t){return e.$set(e._elProps,"page",t)},"update:pageSize":function(t){return e.$set(e._elProps,"limit",t)},"update:page-size":function(t){return e.$set(e._elProps,"limit",t)},"page-change":e.handlePageChange}}):e._e()]},proxy:!0}])},"vxe-grid",e._elProps,!1))],1)]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.cancelText))]),i("el-button",{attrs:{type:"primary"},on:{click:e.selectSubmit}},[e._v(e._s(e.confirmText))])],1)])],1)},a=[],n=i("b85c"),r=i("2909"),s=(i("a9e3"),i("99af"),i("d81d"),i("d3b7"),i("159b"),i("4de4"),i("6062"),i("3ca3"),i("ddb0"),i("60bb")),o=i.n(s),c=i("1fbf"),u=i("22ce"),d={name:"table-selector-input",mixins:[c["d2CrudPlus"].input,c["d2CrudPlus"].inputDict],props:{value:{type:[Number,String,Boolean,Array,Object]},filter:{type:Function,require:!1},filterPlaceholder:{type:String,default:"输入关键字进行过滤"},placeholder:{type:String,default:"请选择"},dialogTitle:{type:String,default:"选择"},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"},treeFilter:{type:Boolean,require:!1,default:!0},multiple:{type:Boolean,default:!1},ignoreFullCheckedChildren:{type:Boolean,default:!0},leafOnly:{type:Boolean,default:!1},includeHalfChecked:{type:Boolean,default:!1},elProps:{type:Object},clearable:{type:Boolean,default:!0},dict:{type:Object,require:!1},pagination:{type:Boolean,default:!1}},data:function(){return{currentValue:void 0,collapseTags:!1,selected:[],dialogVisible:!1,filterText:void 0,requestUrl:null}},created:function(){},computed:{_elProps:function(){var e={highlightCurrent:!this.multiple,props:{},columns:[],border:!0,resizable:!0};return null!=this.dict&&(null!=this.dict.label&&(e.props.label=this.dict.label),null!=this.dict.value&&(e.props.value=this.dict.value),null!=this.dict.children&&(e.props.children=this.dict.children),this.dict.isTree&&(e.treeConfig=this.elProps.treeConfig)),e.nodeKey=e.props.value,o.a.merge(e,this.elProps),this.multiple?(e.checkboxConfig=this.elProps.checkboxConfig?this.elProps.checkboxConfig:{},e.columns=[{type:"checkbox",width:60}].concat(Object(r["a"])(e.columns))):(e.radioConfig=this.elProps.radioConfig?this.elProps.radioConfig:{},e.columns=[{type:"radio",width:60}].concat(Object(r["a"])(e.columns))),e},collapseTagSize:function(){return["small","mini"].indexOf(this.selectSize)>-1?"mini":"small"}},watch:{filterText:function(e){this.searchTableData()}},methods:{onDictLoaded:function(){this.setValue(this.value)},setValue:function(e){var t=this;if(this.currentValue!==this.value){var i=e;if(null==e&&(this.selected=[]),i instanceof Array||(i=[i]),this.dict&&this.dict.getNodes)this.dict.getNodes(i).then((function(i){t.selectedNodes(i,e)}));else{var l=[];if(null==this._options||0===this._options.length)return;var a,r=Object(n["a"])(i);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=this._options,u=c["d2CrudPlus"].util.dict.getByValue(s,o,this.dict);null!=u&&l.push(u)}}catch(d){r.e(d)}finally{r.f()}this.selectedNodes(l,e)}}},selectedNodes:function(e,t){var i,l=[],a=Object(n["a"])(e);try{for(a.s();!(i=a.n()).done;){var r=i.value;r.id=r[this.dict.value],l.push(r)}}catch(s){a.e(s)}finally{a.f()}this.$set(this,"selected",l),this.resetInputHeight()},handleCheckChange:function(e){this.$emit("check-change",e)},handleCurrentChange:function(e){this.$emit("current-change",e)},openDialog:function(){var e=this;this.disabled||(this.dialogVisible=!0,setTimeout((function(){if(null!=e.selected){var t=e.selected.map((function(t){return t[e._elProps.props.value]}));t.forEach((function(t){var i=e.$refs.elTree.store.nodesMap[t];null!=i&&e.doExpandParent(i)})),e.$nextTick((function(){e.multiple?e.$refs.elTree.setCheckboxRow(t):t.length>0&&e.$refs.elTree.setRadioRow(t[0])}))}}),1))},doExpandParent:function(e){null!=e.parent&&this.doExpandParent(e.parent),e.expanded=!0},getValueKey:function(e){return null!=this._elProps.props.value?e[this._elProps.props.value]:e.value},getValueLabel:function(e){return null!=this._elProps.props.label?e[this._elProps.props.label]:e.label},getValueChildren:function(e){var t="children";return null!=this._elProps.props.children&&(t=this._elProps.props.children),e[t]},selectSubmit:function(){var e=this.refreshSelected();this.dialogVisible=!1,this.doValueInputChanged(e)},doValueInputChanged:function(e){var t=this.formatValue(e);this.resetInputHeight(),this.multiple||(t=t&&t.length>0?t[0]:void 0),this.currentValue=t,this.dispatch&&this.dispatch("ElFormItem","el.form.blur"),this.$emit("input",t)},itemClosed:function(e){var t=o.a.without(this.selected,e);this.$set(this,"selected",t),this.doValueInputChanged(t)},refreshSelected:function(){var e=null;if(this.multiple)e=this.$refs.elTree.getCheckboxRecords();else{var t=this.$refs.elTree.getRadioRecord();e=null==t?[]:[t]}return this.ignoreFullCheckedChildren&&(e=this.filterFullCheckedChildren(e)),null!=this.filter&&(e=this.filter(e)),this.$set(this,"selected",e),e},resetInputHeight:function(){var e=this;this.collapseTags&&!this.filterable||this.$nextTick((function(){if(e.$refs.reference){var t=e.$refs.reference.$el.childNodes,i=[].filter.call(t,(function(e){return"INPUT"===e.tagName}))[0],l=e.$refs.tags,a=e.initialInputHeight||40,n=0===e.selected.length?a+"px":Math.max(l?l.clientHeight+(l.clientHeight>a?6:0):0,a)+"px";i.style.height=n,e.visible&&!1!==e.emptyText&&e.broadcast("ElSelectDropdown","updatePopper")}}))},filterFullCheckedChildren:function(e){var t,i=new Set,l=Object(n["a"])(e);try{for(l.s();!(t=l.n()).done;){var a=t.value,r=this.getValueChildren(a);if(null!=r){var s,o=Object(n["a"])(r);try{for(o.s();!(s=o.n()).done;){var c=s.value;i.add(this.getValueKey(c))}}catch(g){o.e(g)}finally{o.f()}}}}catch(g){l.e(g)}finally{l.f()}var u,d=[],h=Object(n["a"])(e);try{for(h.s();!(u=h.n()).done;){var p=u.value,f=this.getValueKey(p);i.has(f)||d.push(p)}}catch(g){h.e(g)}finally{h.f()}return d},formatValue:function(e){var t,i=[],l=Object(n["a"])(e);try{for(l.s();!(t=l.n()).done;){var a=t.value;i.push(this.getValueKey(a))}}catch(r){l.e(r)}finally{l.f()}return i},filterNode:function(e,t){return!e||-1!==this.getValueLabel(t).indexOf(e)},onChange:function(e){this.$emit("change",e),this.dispatch&&this.dispatch("ElFormItem","el.form.blur")},handlePageChange:function(e){var t=e.currentPage,i=e.pageSize,l=this;l._elProps.page=t,l._elProps.limit=i,l.searchTableData()},searchTableData:function(){var e,t,i=this;if(e=i.pagination?{page:i._elProps.page,limit:i._elProps.limit,search:i.filterText}:{search:i.filterText},"function"===typeof i.dict.url){var l=i.d2CrudContext.getForm();t=i.dict.url(i.dict,{form:l})}else t=i.dict.url;Object(u["c"])({url:t,params:e}).then((function(e){i._elProps.page=e.data.page,i._elProps.limit=e.data.limit,i._elProps.total=e.data.total,i.$set(i,"dictOptions",e.data.data)}))},radioChange:function(e){e.checked;var t=e.row,i=e.rowIndex;e.$rowIndex,e.column,e.columnIndex,e.$columnIndex,e.$event;this.$emit("radioChange",{row:t,rowIndex:i})},checkboxChange:function(e){var t=e.checked,i=e.row,l=e.rowIndex,a=e.$rowIndex,n=e.column,r=e.columnIndex,s=e.$columnIndex,o=e.$event;this.$emit("checkboxChange",{checked:t,row:i,rowIndex:l,$rowIndex:a,column:n,columnIndex:r,$columnIndex:s,$event:o})}}},h=d,p=(i("66fe"),i("2877")),f=Object(p["a"])(h,l,a,!1,null,"66379980",null);t["default"]=f.exports},"66fe":function(e,t,i){"use strict";i("d9dd")},d9dd:function(e,t,i){}}]);