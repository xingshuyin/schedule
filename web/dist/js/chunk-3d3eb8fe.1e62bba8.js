(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d3eb8fe","chunk-1b37c24c","chunk-60587ac4","chunk-2d0aeb73","chunk-2d22c35e"],{"07cb":function(e,t,n){"use strict";n("6f08")},"0af2":function(e,t,n){"use strict";n.r(t),n.d(t,"urlPrefix",(function(){return a})),n.d(t,"GetList",(function(){return i})),n.d(t,"createObj",(function(){return s})),n.d(t,"UpdateObj",(function(){return o})),n.d(t,"DelObj",(function(){return c})),n.d(t,"GetMenuData",(function(){return l}));var r=n("22ce"),a="/api/system/role/";function i(e){return Object(r["c"])({url:a,method:"get",params:e}).then((function(e){return e.data.data}))}function s(e){return Object(r["c"])({url:a,method:"post",data:e})}function o(e){return Object(r["c"])({url:a+e.id+"/",method:"put",data:e})}function c(e){return Object(r["c"])({url:a+e+"/",method:"delete",data:{id:e}})}function l(e){return Object(r["c"])({url:"/api/system/role/roleId_get_menu/"+e.id+"/",method:"get",params:{}}).then((function(e){return e.data.data}))}},"1d95":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{margin:"10px"}},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"Save",expression:"'Save'"}],attrs:{type:"primary",size:"mini"},on:{click:e.submitPermisson}},[e._v("保存 ")])],1),n("el-container",{staticStyle:{height:"80vh",border:"1px solid #eee"}},[n("el-aside",{staticStyle:{border:"1px solid #eee",padding:"20px"},attrs:{width:"300px"}},[n("div",{staticStyle:{margin:"10px"}},[n("div",{staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"yxt-flex-align-center"},[n("div",{staticClass:"yxt-divider"}),n("span",[e._v("数据授权")]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.dataAuthorizationTips,placement:"right"}},[n("el-icon",{staticClass:"el-icon-question"})],1)],1)]),n("div",[n("el-select",{directives:[{name:"show",rawName:"v-show",value:e.roleObj.name,expression:"roleObj.name"}],on:{change:e.dataScopeSelectChange},model:{value:e.roleObj.data_range,callback:function(t){e.$set(e.roleObj,"data_range",t)},expression:"roleObj.data_range"}},e._l(e.dataScopeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:4===e.roleObj.data_range,expression:"roleObj.data_range === 4"}],staticClass:"dept-tree"},[n("el-tree",{ref:"dept",attrs:{data:e.deptOptions,"show-checkbox":"","default-expand-all":"","default-checked-keys":e.deptCheckedKeys,"node-key":"id","check-strictly":!0,props:{label:"name"}}})],1)])]),n("el-main",[n("div",{staticStyle:{margin:"10px"}},[n("div",[n("div",{staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"yxt-flex-align-center"},[n("div",{staticClass:"yxt-divider"}),n("span",[e._v("菜单授权")]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.menuAuthorizationTips,placement:"right"}},[n("el-icon",{staticClass:"el-icon-question"})],1)],1)]),n("el-tree",{ref:"menuTree",staticClass:"flow-tree",attrs:{data:e.menuOptions,"node-key":"id","default-expand-all":"","show-checkbox":"","expand-on-click-node":!1,"default-checked-keys":e.menuCheckedKeys,"check-on-click-node":!1,"empty-text":"请先选择角色","check-strictly":!0},on:{"check-change":e.handleCheckClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node"},[n("div",{staticClass:"yxt-flex-between"},[n("div",{style:{width:18*(4-r.level)+100+"px"}},[e._v(e._s(a.name))]),n("div",e._l(a.menuPermission,(function(t,r){return n("el-checkbox",{key:r,model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"item.checked"}},[e._v(e._s(t.name))])})),1)])])}}])})],1)]),n("el-backtop",{attrs:{target:".el-main"}})],1)],1)],1)},a=[],i=n("b85c"),s=(n("4de4"),n("d3b7"),n("d81d"),n("159b"),n("0af2")),o=n("9668"),c=n("c695"),l=n.n(c),u={name:"rolePermission",props:{roleObj:{type:Object,default:function(){return{name:null,data_range:null}}}},data:function(){return{filterText:"",data:[],menuOptions:[],permissionData:[],menuCheckedKeys:[],deptOptions:[],deptCheckedKeys:[],dataScopeOptions:[{value:0,label:"仅本人数据权限"},{value:1,label:"本部门及以下数据权限"},{value:2,label:"本部门数据权限"},{value:3,label:"全部数据权限"},{value:4,label:"自定数据权限"}],dataAuthorizationTips:"授权用户可操作的数据范围",menuAuthorizationTips:"授权用户在菜单中可操作的范围"}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},getCrudOptions:function(){return crudOptions(this)},pageRequest:function(e){var t=this;return s["GetList"](e).then((function(e){e.map((function(e,t){e.node_id=t})),t.data=e,t.$nextTick().then((function(){t.initNode()}))}))},initNode:function(){this.getDeptData(),this.getMenuData(this.roleObj),this.menuCheckedKeys=this.roleObj.menu,this.deptCheckedKeys=this.roleObj.dept},addRequest:function(e){return s["createObj"](e)},updateRequest:function(e){return s["UpdateObj"](e)},delRequest:function(e){return s["DelObj"](e.id)},getDeptData:function(){var e=this;o["GetList"]({status:1}).then((function(t){e.deptOptions=t.data.data}))},getMenuData:function(e){var t=this;s["GetMenuData"](e).then((function(n){n.forEach((function(n){n.menuPermission.forEach((function(n){e.permission.indexOf(n.id)>-1?t.$set(n,"checked",!0):t.$set(n,"checked",!1)}))})),t.menuOptions=l.a.toArrayTree(n,{parentKey:"parent",strict:!0})}))},getMenuAllCheckedKeys:function(){var e=this.$refs.menuTree.getCheckedKeys(),t=this.$refs.menuTree.getHalfCheckedKeys();return e.unshift.apply(e,t),e},getDeptAllCheckedKeys:function(){var e=this.$refs.dept.getCheckedKeys(),t=this.$refs.dept.getHalfCheckedKeys();return e.unshift.apply(e,t),e},submitPermisson:function(){var e=this;this.roleObj.menu=this.getMenuAllCheckedKeys(),this.roleObj.dept=this.getDeptAllCheckedKeys();var t=l.a.toTreeArray(this.menuOptions),n=[];return t.forEach((function(e){var t=e.menuPermission.filter((function(e){return e.checked}));if(t.length>0){var r,a=Object(i["a"])(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;n.push(s.id)}}catch(o){a.e(o)}finally{a.f()}}})),this.roleObj.permission=n,this.updateRequest(this.roleObj).then((function(t){e.$message.success("更新成功")}))},dataScopeSelectChange:function(e){},handleCheckClick:function(e,t){var n,r=e.menuPermission,a=e.children,s=Object(i["a"])(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;this.$set(o,"checked",t)}}catch(d){s.e(d)}finally{s.f()}if(a){var c,l=Object(i["a"])(a);try{for(l.s();!(c=l.n()).done;){var u=c.value;this.$refs.menuTree.setChecked(u.id,t)}}catch(d){l.e(d)}finally{l.f()}}}},created:function(){this.pageRequest()}},d=u,p=(n("07cb"),n("2877")),h=Object(p["a"])(d,r,a,!1,null,null,null);t["default"]=h.exports},"6d1f":function(e,t,n){"use strict";n("fe41")},"6f08":function(e,t,n){},"70eb":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("d2-container",{class:{"page-compact":e.crud.pageOptions.compact}},[n("d2-crud-x",e._g(e._b({ref:"d2Crud",on:{createPermission:e.createPermission}},"d2-crud-x",e._crudProps,!1),e._crudListeners),[n("div",{attrs:{slot:"header"},slot:"header"},[n("crud-search",{ref:"search",attrs:{options:e.crud.searchOptions},on:{submit:e.handleSearch}}),n("el-button-group",[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"Create",expression:"'Create'"}],attrs:{size:"small",type:"primary"},on:{click:e.addRow}},[n("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])],1),n("crud-toolbar",{attrs:{search:e.crud.searchOptions.show,compact:e.crud.pageOptions.compact,columns:e.crud.columns},on:{"update:search":function(t){return e.$set(e.crud.searchOptions,"show",t)},"update:compact":function(t){return e.$set(e.crud.pageOptions,"compact",t)},refresh:function(t){return e.doRefresh()},"columns-filter-changed":e.handleColumnsFilterChanged}})],1)]),n("div",[n("el-drawer",{attrs:{title:"角色授权",visible:e.rolePermissionShow,direction:"rtl",size:"70%"},on:{"update:visible":function(t){e.rolePermissionShow=t}}},[n("template",{slot:"title"},[n("div",[e._v(" 当前角色"),n("el-tag",[e._v(e._s(e.roleObj?e.roleObj.name:"无"))])],1)]),n("div",[e.rolePermissionShow?n("rolePermission",{attrs:{"role-obj":e.roleObj}}):e._e()],1)],2)],1)],1)},a=[],i=n("f1eb"),s=n("bc5c"),o=n("1fbf"),c=n("1d95"),l={name:"role",mixins:[o["d2CrudPlus"].crud],components:{rolePermission:c["default"]},data:function(){return{rolePermissionShow:!1,roleObj:void 0}},methods:{getCrudOptions:function(){return Object(s["crudOptions"])(this)},pageRequest:function(e){return i["GetList"](e)},addRequest:function(e){return i["createObj"](e)},updateRequest:function(e){return i["UpdateObj"](e)},delRequest:function(e){return i["DelObj"](e.id)},createPermission:function(e){console.log(e),this.roleObj=e.row,this.rolePermissionShow=!0}}},u=l,d=(n("6d1f"),n("2877")),p=Object(d["a"])(u,r,a,!1,null,null,null);t["default"]=p.exports},ab1d:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return o}));n("d81d");var r={1:"success",true:"success",0:"danger",false:"danger",Search:"warning",Update:"primary",Create:"success",Retrieve:"info",Delete:"danger"};function a(e){return e.map((function(e){return{label:e.label,value:e.value,color:r[e.value]}}))}var i=a([{label:"启用",value:!0},{label:"禁用",value:!1}]),s=a([{label:"启用",value:1},{label:"禁用",value:0}]),o=(a([{label:"是",value:1},{label:"否",value:0}]),a([{label:"是",value:!0},{label:"否",value:!1}]))},bc5c:function(e,t,n){"use strict";n.r(t),n.d(t,"crudOptions",(function(){return a}));n("99af");var r=n("ab1d"),a=function(e){return{pageOptions:{compact:!0},options:{tableType:"vxe-table",rowKey:!0,rowId:"id",height:"100%",highlightCurrentRow:!1},rowHandle:{view:{thin:!0,text:"",disabled:function(){return!e.hasPermissions("Retrieve")}},width:230,edit:{thin:!0,text:"",disabled:function(){return!e.hasPermissions("Update")}},remove:{thin:!0,text:"",disabled:function(){return!e.hasPermissions("Delete")}},custom:[{show:function(e,t){return!0},disabled:function(){return!e.hasPermissions("Update")},text:"权限管理",type:"warning",size:"small",emit:"createPermission"}]},indexRow:{title:"序号",align:"center",width:100},viewOptions:{componentType:"form"},formOptions:{defaultSpan:24,width:"35%"},columns:[{title:"关键词",key:"search",show:!1,disabled:!0,search:{disabled:!1},form:{disabled:!0,component:{props:{clearable:!0},placeholder:"请输入关键词"}},view:{disabled:!0}},{title:"ID",key:"id",show:!1,width:90,form:{disabled:!0}},{title:"角色名称",key:"name",sortable:!0,search:{disabled:!1,component:{props:{clearable:!0}}},type:"input",form:{rules:[{required:!0,message:"角色名称必填项"}],component:{props:{clearable:!0},placeholder:"请输入角色名称"},itemProps:{class:{yxtInput:!0}}}},{title:"权限标识",key:"key",sortable:!0,form:{rules:[{required:!0,message:"权限标识必填项"}],component:{props:{clearable:!0},placeholder:"请输入标识字符"},itemProps:{class:{yxtInput:!0}}}},{title:"排序",key:"sort",sortable:!0,width:80,type:"number",form:{value:1,component:{placeholder:"请输入排序"}}},{title:"是否管理员",key:"admin",sortable:!0,type:"radio",dict:{data:r["d"]},form:{value:!1,component:{placeholder:"请选择是否管理员"}}},{title:"状态",key:"status",sortable:!0,search:{disabled:!1},type:"radio",dict:{data:r["a"]},form:{value:!0,component:{placeholder:"请选择状态"}},component:{props:{color:"auto"}}}].concat(e.commonEndColumns())}}},f1eb:function(e,t,n){"use strict";n.r(t),n.d(t,"urlPrefix",(function(){return a})),n.d(t,"GetList",(function(){return i})),n.d(t,"GetObj",(function(){return s})),n.d(t,"createObj",(function(){return o})),n.d(t,"UpdateObj",(function(){return c})),n.d(t,"DelObj",(function(){return l}));var r=n("22ce"),a="/api/system/role/";function i(e){return Object(r["c"])({url:a,method:"get",params:e})}function s(e){return Object(r["c"])({url:a+e.id+"/",method:"get"})}function o(e){return Object(r["c"])({url:a,method:"post",data:e})}function c(e){return Object(r["c"])({url:a+e.id+"/",method:"put",data:e})}function l(e){return Object(r["c"])({url:a+e+"/",method:"delete",data:{id:e}})}},fe41:function(e,t,n){}}]);