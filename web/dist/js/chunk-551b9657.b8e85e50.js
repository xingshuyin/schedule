(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-551b9657","chunk-2d0e28c4","chunk-f90d6396"],{"398b":function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:4}},[e._v("变量标题")]),i("el-col",{attrs:{span:12}},[e._v("变量值")]),i("el-col",{attrs:{span:4,offset:4}},[e._v("变量名")])],1),i("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{model:e.form,"label-width":"100px","label-position":"left"}},[e._l(e.formList,(function(t,l){return i("el-form-item",{key:l,attrs:{label:t.title,prop:["array"].indexOf(t.form_item_type_label)>-1?"":t.key,rules:t.rule}},[i("el-col",{attrs:{span:12,offset:2}},[["text","textarea"].indexOf(t.form_item_type_label)>-1?i("el-input",{key:l,attrs:{type:t.form_item_type_label,placeholder:t.placeholder,clearable:""},model:{value:e.form[t.key],callback:function(i){e.$set(e.form,t.key,i)},expression:"form[item.key]"}}):"number"===t.form_item_type_label?i("el-input-number",{key:l,attrs:{min:0},model:{value:e.form[t.key],callback:function(i){e.$set(e.form,t.key,i)},expression:"form[item.key]"}}):["img","imgs"].indexOf(t.form_item_type_label)>-1?i("div",{key:l},[i("el-upload",{ref:"imgUpload_"+t.key,refInFor:!0,attrs:{action:e.imgUploadUrl,headers:e.uploadHeaders,name:"url",accept:"image/*","on-preview":e.handlePictureCardPreview,"on-success":function(i,l,a){e.handleUploadSuccess(i,l,a,t.key)},"on-error":e.handleError,"on-exceed":e.handleExceed,limit:"img"===t.form_item_type_label?1:5,"data-keyname":t.key,"file-list":t.value?t.value:[],"list-type":"picture-card"}},[i("i",{staticClass:"el-icon-plus"}),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("选取图片后,需手动上传到服务器,并且只能上传jpg/png文件")])]),i("el-dialog",{attrs:{visible:e.dialogImgVisible},on:{"update:visible":function(t){e.dialogImgVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1):["foreignkey","manytomany"].indexOf(t.form_item_type_label)>-1?i("div",{key:l},[i("table-selector",{attrs:{"el-props":{pagination:!0,columns:t.setting.searchField},dict:{url:"/api/system/system_config/get_table_data/"+t.id+"/",value:t.setting.primarykey,label:t.setting.field},pagination:!0,multiple:"manytomany"===t.form_item_type_label},model:{value:e.form[t.key],callback:function(i){e.$set(e.form,t.key,i)},expression:"form[item.key]"}})],1):"array"===t.form_item_type_label?i("div",{key:l},[i("vxe-table",{ref:"xTable_"+t.key,refInFor:!0,attrs:{border:"",resizable:"","auto-resize":"","show-overflow":"","keep-source":"",height:"200","edit-rules":e.validRules,"edit-config":{trigger:"click",mode:"row",showStatus:!0}}},[i("vxe-column",{attrs:{field:"title",title:"标题","edit-render":{autofocus:".vxe-input--inner"}},scopedSlots:e._u([{key:"edit",fn:function(t){var l=t.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:l.title,callback:function(t){e.$set(l,"title",t)},expression:"row.title"}})]}}],null,!0)}),i("vxe-column",{attrs:{field:"key",title:"键名","edit-render":{autofocus:".vxe-input--inner"}},scopedSlots:e._u([{key:"edit",fn:function(t){var l=t.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:l.key,callback:function(t){e.$set(l,"key",t)},expression:"row.key"}})]}}],null,!0)}),i("vxe-column",{attrs:{field:"value",title:"键值","edit-render":{}},scopedSlots:e._u([{key:"edit",fn:function(t){var l=t.row;return[i("vxe-input",{attrs:{type:"text"},model:{value:l.value,callback:function(t){e.$set(l,"value",t)},expression:"row.value"}})]}}],null,!0)}),i("vxe-column",{attrs:{title:"操作",width:"100","show-overflow":""},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row,a=t.index;return[i("el-popover",{attrs:{placement:"top",width:"160"},model:{value:e.childRemoveVisible,callback:function(t){e.childRemoveVisible=t},expression:"childRemoveVisible"}},[i("p",[e._v("删除后无法恢复,确定删除吗？")]),i("div",{staticStyle:{"text-align":"right",margin:"0"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.childRemoveVisible=!1}}},[e._v("取消")]),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.onRemoveChild(l,a)}}},[e._v("确定")])],1),i("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1)]}}],null,!0)})],1),i("div",[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return e.onAppend("xTable_"+t.key)}}},[e._v("追加")])],1)],1):e._e()],1),i("el-col",{attrs:{span:4,offset:6}},[e._v(e._s(e.editableTabsItem.key)+"."+e._s(t.key))])],1)})),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")])],1)],2)],1)},a=[],r=i("1da1"),n=i("b85c"),o=(i("96cf"),i("e9c4"),i("b64b"),i("07ac"),i("a434"),i("8a79"),i("b0c0"),i("7ebb")),s=i("c276"),c=i("5a20"),u={name:"formContent",inject:["refreshView"],components:{tableSelector:c["default"]},props:{options:{type:Object},editableTabsItem:{type:Object}},watch:{options:{handler:function(e){e&&e.id&&this.getInit()},immediate:!0}},data:function(){return{formList:[],form:{},childTableData:[],childRemoveVisible:!1,validRules:{title:[{required:!0,message:"必须填写"}],key:[{required:!0,message:"必须填写"}],value:[{required:!0,message:"必须填写"}]},imgUploadUrl:s["a"].baseURL()+"api/system/img/",uploadHeaders:{Authorization:"JWT "+s["a"].cookies.get("token")},dialogImageUrl:"",dialogImgVisible:!1,uploadImgKey:null}},methods:{getInit:function(){var e=this,t=this;o["GetList"]({parent:this.options.id}).then((function(i){var l=i.data.data;e.formList=l;var a,r={},o=Object(n["a"])(l);try{var s=function(){var i=a.value,l=i.key;r[l]=i.value,"array"===i.form_item_type_label&&t.$nextTick((function(){var t="xTable_"+l,a=e.$refs[t][0];a.loadData(i.chinldern)}))};for(o.s();!(a=o.n()).done;)s()}catch(c){o.e(c)}finally{o.f()}e.form=JSON.parse(JSON.stringify(r))}))},onSubmit:function(){var e=this,t=this,i=JSON.parse(JSON.stringify(this.form)),l=Object.keys(i),a=Object.values(i);for(var r in this.formList){var s=this.formList[r],c=s.form_item_type_label;if("array"===c){var u,d=s.id,f="xTable_"+s.key,p=this.$refs[f][0],h=p.getTableData(),m=h.tableData,g=Object(n["a"])(m);try{for(g.s();!(u=g.n()).done;){var v=u.value;!v.id&&v.key&&v.value&&(v.parent=d,v.id=null,this.formList.push(v))}}catch(w){g.e(w)}finally{g.f()}var b,y=Object(n["a"])(s.rule);try{for(y.s();!(b=y.n()).done;){var _=b.value;if(_.required&&0===m.length)return void t.$message.error(s.title+"不能为空")}}catch(w){y.e(w)}finally{y.f()}s.value=m}if(l[r]===s.key&&("array"!==s.form_item_type_label&&(s.value=a[r]),["img","imgs"].indexOf(s.form_item_type_label)>-1)){var x,k=Object(n["a"])(s.rule);try{for(k.s();!(x=k.n()).done;){var C=x.value;if(C.required&&null===s.value)return void t.$message.error(s.title+"不能为空")}}catch(w){k.e(w)}finally{k.f()}}}t.$refs.form.clearValidate(),t.$refs.form.validate((function(t){if(console.log(e.formList),!t)return console.log("error submit!!"),!1;o["saveContent"](e.options.id,e.formList).then((function(t){e.$message.success("保存成功"),e.refreshView()}))}))},onAppend:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var l,a,r,n,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(l=t.$refs[e][0],a=l.getTableData(),r=a.tableData,n=r.length,0===n){i.next=8;break}return i.next=6,l.validate().catch((function(e){return e}));case 6:o=i.sent,o&&t.$message.error("校验不通过！");case 8:case"end":return i.stop()}}),i)})))()},onRemoveChild:function(e,t){e.id?console.log(1,"ok"):this.childTableData.splice(t,1)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogImgVisible=!0},submitUpload:function(e){var t="imgUpload_"+e,i=this.$refs[t][0];i.submit(),this.uploadImgKey=e},isImage:function(e){if("string"===typeof e){var t=e.toLowerCase();return t.endsWith(".png")||t.endsWith(".jpeg")||t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".bmp")}},handleUploadSuccess:function(e,t,i,l){var a=this,r=e.code,n=e.msg;if(2e3===r){var o=e.data.data.url,s=t.name,c=a.isImage(s);if(c){var u=a.form[l];u||(a.form[l]=[]);var d={name:s,url:o};a.form[l].push(d)}else this.$message.error("只允许上传图片")}else this.$message.error("上传失败,"+JSON.stringify(n))},handleError:function(){this.$message.error("上传失败")},handleExceed:function(){this.$message.error("超过文件上传数量")}},mounted:function(){}},d=u,f=i("2877"),p=Object(f["a"])(d,l,a,!1,null,"46dc821a",null);t["default"]=p.exports},"5a20":function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"d2p-tree-selector"},[i("div",{staticClass:"el-cascader el-cascader--default",class:{"is-disabled":e.disabled},on:{click:e.openDialog}},[i("div",{staticClass:"el-input el-input--default el-input--suffix",class:{"is-disabled":e.disabled}},[i("el-input",{ref:"reference",attrs:{disabled:e.disabled,placeholder:0===e.selected.length?e.placeholder:""}}),i("span",{staticClass:"el-input__suffix"},[i("span",{staticClass:"el-input__suffix-inner"},[i("i",{staticClass:"el-input__icon el-icon-arrow-down",on:{click:e.openDialog}})])])],1),i("div",{ref:"tags",staticClass:"el-cascader__tags"},[i("transition-group",{on:{"after-leave":e.resetInputHeight}},e._l(e.selected,(function(t){return i("el-tag",{key:e.getValueKey(t),attrs:{closable:e.clearable,size:e.collapseTagSize,hit:!1,type:"info","disable-transitions":""},on:{close:function(i){return e.itemClosed(t)}}},[i("span",{staticClass:"el-select__tags-text"},[e._v(e._s(e.getValueLabel(t)))])])})),1)],1)]),i("el-dialog",{attrs:{"custom-class":"d2p-tree-selector-dialog",title:e.dialogTitle,visible:e.dialogVisible,width:"50%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticClass:"tree-wrapper"},[e.treeFilter?i("div",{staticClass:"filter-bar",staticStyle:{"padding-bottom":"20px"}},[i("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:e.filterPlaceholder,size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1):e._e(),i("div",{staticClass:"tree-body"},[i("vxe-grid",e._b({ref:"elTree",attrs:{data:e._options,"auto-resize":!0},on:{"radio-change":e.radioChange,"checkbox-change":e.checkboxChange},scopedSlots:e._u([{key:"pager",fn:function(){return[e.pagination?i("vxe-pager",{staticStyle:{"margin-top":"10px"},attrs:{layouts:["Sizes","PrevJump","PrevPage","Number","NextPage","NextJump","FullJump","Total"],"current-page":e._elProps.page,"page-size":e._elProps.limit,total:e._elProps.total},on:{"update:currentPage":function(t){return e.$set(e._elProps,"page",t)},"update:current-page":function(t){return e.$set(e._elProps,"page",t)},"update:pageSize":function(t){return e.$set(e._elProps,"limit",t)},"update:page-size":function(t){return e.$set(e._elProps,"limit",t)},"page-change":e.handlePageChange}}):e._e()]},proxy:!0}])},"vxe-grid",e._elProps,!1))],1)]),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.cancelText))]),i("el-button",{attrs:{type:"primary"},on:{click:e.selectSubmit}},[e._v(e._s(e.confirmText))])],1)])],1)},a=[],r=i("b85c"),n=i("2909"),o=(i("a9e3"),i("99af"),i("d81d"),i("d3b7"),i("159b"),i("4de4"),i("6062"),i("3ca3"),i("ddb0"),i("60bb")),s=i.n(o),c=i("1fbf"),u=i("22ce"),d={name:"table-selector-input",mixins:[c["d2CrudPlus"].input,c["d2CrudPlus"].inputDict],props:{value:{type:[Number,String,Boolean,Array,Object]},filter:{type:Function,require:!1},filterPlaceholder:{type:String,default:"输入关键字进行过滤"},placeholder:{type:String,default:"请选择"},dialogTitle:{type:String,default:"选择"},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"},treeFilter:{type:Boolean,require:!1,default:!0},multiple:{type:Boolean,default:!1},ignoreFullCheckedChildren:{type:Boolean,default:!0},leafOnly:{type:Boolean,default:!1},includeHalfChecked:{type:Boolean,default:!1},elProps:{type:Object},clearable:{type:Boolean,default:!0},dict:{type:Object,require:!1},pagination:{type:Boolean,default:!1}},data:function(){return{currentValue:void 0,collapseTags:!1,selected:[],dialogVisible:!1,filterText:void 0,requestUrl:null}},created:function(){},computed:{_elProps:function(){var e={highlightCurrent:!this.multiple,props:{},columns:[],border:!0,resizable:!0};return null!=this.dict&&(null!=this.dict.label&&(e.props.label=this.dict.label),null!=this.dict.value&&(e.props.value=this.dict.value),null!=this.dict.children&&(e.props.children=this.dict.children),this.dict.isTree&&(e.treeConfig=this.elProps.treeConfig)),e.nodeKey=e.props.value,s.a.merge(e,this.elProps),this.multiple?(e.checkboxConfig=this.elProps.checkboxConfig?this.elProps.checkboxConfig:{},e.columns=[{type:"checkbox",width:60}].concat(Object(n["a"])(e.columns))):(e.radioConfig=this.elProps.radioConfig?this.elProps.radioConfig:{},e.columns=[{type:"radio",width:60}].concat(Object(n["a"])(e.columns))),e},collapseTagSize:function(){return["small","mini"].indexOf(this.selectSize)>-1?"mini":"small"}},watch:{filterText:function(e){this.searchTableData()}},methods:{onDictLoaded:function(){this.setValue(this.value)},setValue:function(e){var t=this;if(this.currentValue!==this.value){var i=e;if(null==e&&(this.selected=[]),i instanceof Array||(i=[i]),this.dict&&this.dict.getNodes)this.dict.getNodes(i).then((function(i){t.selectedNodes(i,e)}));else{var l=[];if(null==this._options||0===this._options.length)return;var a,n=Object(r["a"])(i);try{for(n.s();!(a=n.n()).done;){var o=a.value,s=this._options,u=c["d2CrudPlus"].util.dict.getByValue(o,s,this.dict);null!=u&&l.push(u)}}catch(d){n.e(d)}finally{n.f()}this.selectedNodes(l,e)}}},selectedNodes:function(e,t){var i,l=[],a=Object(r["a"])(e);try{for(a.s();!(i=a.n()).done;){var n=i.value;n.id=n[this.dict.value],l.push(n)}}catch(o){a.e(o)}finally{a.f()}this.$set(this,"selected",l),this.resetInputHeight()},handleCheckChange:function(e){this.$emit("check-change",e)},handleCurrentChange:function(e){this.$emit("current-change",e)},openDialog:function(){var e=this;this.disabled||(this.dialogVisible=!0,setTimeout((function(){if(null!=e.selected){var t=e.selected.map((function(t){return t[e._elProps.props.value]}));t.forEach((function(t){var i=e.$refs.elTree.store.nodesMap[t];null!=i&&e.doExpandParent(i)})),e.$nextTick((function(){e.multiple?e.$refs.elTree.setCheckboxRow(t):t.length>0&&e.$refs.elTree.setRadioRow(t[0])}))}}),1))},doExpandParent:function(e){null!=e.parent&&this.doExpandParent(e.parent),e.expanded=!0},getValueKey:function(e){return null!=this._elProps.props.value?e[this._elProps.props.value]:e.value},getValueLabel:function(e){return null!=this._elProps.props.label?e[this._elProps.props.label]:e.label},getValueChildren:function(e){var t="children";return null!=this._elProps.props.children&&(t=this._elProps.props.children),e[t]},selectSubmit:function(){var e=this.refreshSelected();this.dialogVisible=!1,this.doValueInputChanged(e)},doValueInputChanged:function(e){var t=this.formatValue(e);this.resetInputHeight(),this.multiple||(t=t&&t.length>0?t[0]:void 0),this.currentValue=t,this.dispatch&&this.dispatch("ElFormItem","el.form.blur"),this.$emit("input",t)},itemClosed:function(e){var t=s.a.without(this.selected,e);this.$set(this,"selected",t),this.doValueInputChanged(t)},refreshSelected:function(){var e=null;if(this.multiple)e=this.$refs.elTree.getCheckboxRecords();else{var t=this.$refs.elTree.getRadioRecord();e=null==t?[]:[t]}return this.ignoreFullCheckedChildren&&(e=this.filterFullCheckedChildren(e)),null!=this.filter&&(e=this.filter(e)),this.$set(this,"selected",e),e},resetInputHeight:function(){var e=this;this.collapseTags&&!this.filterable||this.$nextTick((function(){if(e.$refs.reference){var t=e.$refs.reference.$el.childNodes,i=[].filter.call(t,(function(e){return"INPUT"===e.tagName}))[0],l=e.$refs.tags,a=e.initialInputHeight||40,r=0===e.selected.length?a+"px":Math.max(l?l.clientHeight+(l.clientHeight>a?6:0):0,a)+"px";i.style.height=r,e.visible&&!1!==e.emptyText&&e.broadcast("ElSelectDropdown","updatePopper")}}))},filterFullCheckedChildren:function(e){var t,i=new Set,l=Object(r["a"])(e);try{for(l.s();!(t=l.n()).done;){var a=t.value,n=this.getValueChildren(a);if(null!=n){var o,s=Object(r["a"])(n);try{for(s.s();!(o=s.n()).done;){var c=o.value;i.add(this.getValueKey(c))}}catch(m){s.e(m)}finally{s.f()}}}}catch(m){l.e(m)}finally{l.f()}var u,d=[],f=Object(r["a"])(e);try{for(f.s();!(u=f.n()).done;){var p=u.value,h=this.getValueKey(p);i.has(h)||d.push(p)}}catch(m){f.e(m)}finally{f.f()}return d},formatValue:function(e){var t,i=[],l=Object(r["a"])(e);try{for(l.s();!(t=l.n()).done;){var a=t.value;i.push(this.getValueKey(a))}}catch(n){l.e(n)}finally{l.f()}return i},filterNode:function(e,t){return!e||-1!==this.getValueLabel(t).indexOf(e)},onChange:function(e){this.$emit("change",e),this.dispatch&&this.dispatch("ElFormItem","el.form.blur")},handlePageChange:function(e){var t=e.currentPage,i=e.pageSize,l=this;l._elProps.page=t,l._elProps.limit=i,l.searchTableData()},searchTableData:function(){var e,t,i=this;if(e=i.pagination?{page:i._elProps.page,limit:i._elProps.limit,search:i.filterText}:{search:i.filterText},"function"===typeof i.dict.url){var l=i.d2CrudContext.getForm();t=i.dict.url(i.dict,{form:l})}else t=i.dict.url;Object(u["c"])({url:t,params:e}).then((function(e){i._elProps.page=e.data.page,i._elProps.limit=e.data.limit,i._elProps.total=e.data.total,i.$set(i,"dictOptions",e.data.data)}))},radioChange:function(e){e.checked;var t=e.row,i=e.rowIndex;e.$rowIndex,e.column,e.columnIndex,e.$columnIndex,e.$event;this.$emit("radioChange",{row:t,rowIndex:i})},checkboxChange:function(e){var t=e.checked,i=e.row,l=e.rowIndex,a=e.$rowIndex,r=e.column,n=e.columnIndex,o=e.$columnIndex,s=e.$event;this.$emit("checkboxChange",{checked:t,row:i,rowIndex:l,$rowIndex:a,column:r,columnIndex:n,$columnIndex:o,$event:s})}}},f=d,p=(i("66fe"),i("2877")),h=Object(p["a"])(f,l,a,!1,null,"66379980",null);t["default"]=h.exports},"66fe":function(e,t,i){"use strict";i("d9dd")},"7ebb":function(e,t,i){"use strict";i.r(t),i.d(t,"urlPrefix",(function(){return a})),i.d(t,"GetList",(function(){return r})),i.d(t,"saveContent",(function(){return n})),i.d(t,"createObj",(function(){return o})),i.d(t,"UpdateObj",(function(){return s})),i.d(t,"DelObj",(function(){return c})),i.d(t,"GetAssociationTable",(function(){return u}));var l=i("22ce"),a="/api/system/system_config/";function r(e){return Object(l["c"])({url:a,method:"get",params:e})}function n(e,t){return Object(l["c"])({url:a+"save_content/",method:"put",data:t})}function o(e){return Object(l["c"])({url:a,method:"post",data:e})}function s(e){return Object(l["c"])({url:a+e.id+"/",method:"put",data:e})}function c(e){return Object(l["c"])({url:a+e+"/",method:"delete",data:{id:e}})}function u(){return Object(l["c"])({url:a+"get_association_table/",method:"get",params:{}})}},d9dd:function(e,t,i){}}]);