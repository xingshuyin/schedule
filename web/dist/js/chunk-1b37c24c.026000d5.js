(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b37c24c","chunk-2d0aeb73"],{"07cb":function(e,t,n){"use strict";n("6f08")},"0af2":function(e,t,n){"use strict";n.r(t),n.d(t,"urlPrefix",(function(){return i})),n.d(t,"GetList",(function(){return s})),n.d(t,"createObj",(function(){return r})),n.d(t,"UpdateObj",(function(){return c})),n.d(t,"DelObj",(function(){return o})),n.d(t,"GetMenuData",(function(){return l}));var a=n("22ce"),i="/api/system/role/";function s(e){return Object(a["c"])({url:i,method:"get",params:e}).then((function(e){return e.data.data}))}function r(e){return Object(a["c"])({url:i,method:"post",data:e})}function c(e){return Object(a["c"])({url:i+e.id+"/",method:"put",data:e})}function o(e){return Object(a["c"])({url:i+e+"/",method:"delete",data:{id:e}})}function l(e){return Object(a["c"])({url:"/api/system/role/roleId_get_menu/"+e.id+"/",method:"get",params:{}}).then((function(e){return e.data.data}))}},"1d95":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{margin:"10px"}},[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"Save",expression:"'Save'"}],attrs:{type:"primary",size:"mini"},on:{click:e.submitPermisson}},[e._v("保存 ")])],1),n("el-container",{staticStyle:{height:"80vh",border:"1px solid #eee"}},[n("el-aside",{staticStyle:{border:"1px solid #eee",padding:"20px"},attrs:{width:"300px"}},[n("div",{staticStyle:{margin:"10px"}},[n("div",{staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"yxt-flex-align-center"},[n("div",{staticClass:"yxt-divider"}),n("span",[e._v("数据授权")]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.dataAuthorizationTips,placement:"right"}},[n("el-icon",{staticClass:"el-icon-question"})],1)],1)]),n("div",[n("el-select",{directives:[{name:"show",rawName:"v-show",value:e.roleObj.name,expression:"roleObj.name"}],on:{change:e.dataScopeSelectChange},model:{value:e.roleObj.data_range,callback:function(t){e.$set(e.roleObj,"data_range",t)},expression:"roleObj.data_range"}},e._l(e.dataScopeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:4===e.roleObj.data_range,expression:"roleObj.data_range === 4"}],staticClass:"dept-tree"},[n("el-tree",{ref:"dept",attrs:{data:e.deptOptions,"show-checkbox":"","default-expand-all":"","default-checked-keys":e.deptCheckedKeys,"node-key":"id","check-strictly":!0,props:{label:"name"}}})],1)])]),n("el-main",[n("div",{staticStyle:{margin:"10px"}},[n("div",[n("div",{staticStyle:{"margin-bottom":"20px"}},[n("div",{staticClass:"yxt-flex-align-center"},[n("div",{staticClass:"yxt-divider"}),n("span",[e._v("菜单授权")]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.menuAuthorizationTips,placement:"right"}},[n("el-icon",{staticClass:"el-icon-question"})],1)],1)]),n("el-tree",{ref:"menuTree",staticClass:"flow-tree",attrs:{data:e.menuOptions,"node-key":"id","default-expand-all":"","show-checkbox":"","expand-on-click-node":!1,"default-checked-keys":e.menuCheckedKeys,"check-on-click-node":!1,"empty-text":"请先选择角色","check-strictly":!0},on:{"check-change":e.handleCheckClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,i=t.data;return n("span",{staticClass:"custom-tree-node"},[n("div",{staticClass:"yxt-flex-between"},[n("div",{style:{width:18*(4-a.level)+100+"px"}},[e._v(e._s(i.name))]),n("div",e._l(i.menuPermission,(function(t,a){return n("el-checkbox",{key:a,model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"item.checked"}},[e._v(e._s(t.name))])})),1)])])}}])})],1)]),n("el-backtop",{attrs:{target:".el-main"}})],1)],1)],1)},i=[],s=n("b85c"),r=(n("4de4"),n("d3b7"),n("d81d"),n("159b"),n("0af2")),c=n("9668"),o=n("c695"),l=n.n(o),u={name:"rolePermission",props:{roleObj:{type:Object,default:function(){return{name:null,data_range:null}}}},data:function(){return{filterText:"",data:[],menuOptions:[],permissionData:[],menuCheckedKeys:[],deptOptions:[],deptCheckedKeys:[],dataScopeOptions:[{value:0,label:"仅本人数据权限"},{value:1,label:"本部门及以下数据权限"},{value:2,label:"本部门数据权限"},{value:3,label:"全部数据权限"},{value:4,label:"自定数据权限"}],dataAuthorizationTips:"授权用户可操作的数据范围",menuAuthorizationTips:"授权用户在菜单中可操作的范围"}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},getCrudOptions:function(){return crudOptions(this)},pageRequest:function(e){var t=this;return r["GetList"](e).then((function(e){e.map((function(e,t){e.node_id=t})),t.data=e,t.$nextTick().then((function(){t.initNode()}))}))},initNode:function(){this.getDeptData(),this.getMenuData(this.roleObj),this.menuCheckedKeys=this.roleObj.menu,this.deptCheckedKeys=this.roleObj.dept},addRequest:function(e){return r["createObj"](e)},updateRequest:function(e){return r["UpdateObj"](e)},delRequest:function(e){return r["DelObj"](e.id)},getDeptData:function(){var e=this;c["GetList"]({status:1}).then((function(t){e.deptOptions=t.data.data}))},getMenuData:function(e){var t=this;r["GetMenuData"](e).then((function(n){n.forEach((function(n){n.menuPermission.forEach((function(n){e.permission.indexOf(n.id)>-1?t.$set(n,"checked",!0):t.$set(n,"checked",!1)}))})),t.menuOptions=l.a.toArrayTree(n,{parentKey:"parent",strict:!0})}))},getMenuAllCheckedKeys:function(){var e=this.$refs.menuTree.getCheckedKeys(),t=this.$refs.menuTree.getHalfCheckedKeys();return e.unshift.apply(e,t),e},getDeptAllCheckedKeys:function(){var e=this.$refs.dept.getCheckedKeys(),t=this.$refs.dept.getHalfCheckedKeys();return e.unshift.apply(e,t),e},submitPermisson:function(){var e=this;this.roleObj.menu=this.getMenuAllCheckedKeys(),this.roleObj.dept=this.getDeptAllCheckedKeys();var t=l.a.toTreeArray(this.menuOptions),n=[];return t.forEach((function(e){var t=e.menuPermission.filter((function(e){return e.checked}));if(t.length>0){var a,i=Object(s["a"])(t);try{for(i.s();!(a=i.n()).done;){var r=a.value;n.push(r.id)}}catch(c){i.e(c)}finally{i.f()}}})),this.roleObj.permission=n,this.updateRequest(this.roleObj).then((function(t){e.$message.success("更新成功")}))},dataScopeSelectChange:function(e){},handleCheckClick:function(e,t){var n,a=e.menuPermission,i=e.children,r=Object(s["a"])(a);try{for(r.s();!(n=r.n()).done;){var c=n.value;this.$set(c,"checked",t)}}catch(d){r.e(d)}finally{r.f()}if(i){var o,l=Object(s["a"])(i);try{for(l.s();!(o=l.n()).done;){var u=o.value;this.$refs.menuTree.setChecked(u.id,t)}}catch(d){l.e(d)}finally{l.f()}}}},created:function(){this.pageRequest()}},d=u,h=(n("07cb"),n("2877")),f=Object(h["a"])(d,a,i,!1,null,null,null);t["default"]=f.exports},"6f08":function(e,t,n){}}]);